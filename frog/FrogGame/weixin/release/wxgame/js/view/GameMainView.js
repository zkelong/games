var game,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}();!function(t){!function(i){var e=def.GameConfig,s=i.GameOverView,a=t.Frog,r=function(i){function r(t){var e=i.call(this)||this;return e.BEGINXPOS=150,e.COUNTDOWNNUM=3,e.gameStatus=0,e.pillarArray=[],e.lastStepBig=!0,e.lastHaveTrap=!1,e.score=0,e.stepBig=!1,e.speedAddTag=0,e.mousePos={time:0,x:0,y:0},e.pillarYPos=3*Laya.stage.height/5,e.size(Laya.stage.width,Laya.stage.height),e.gameMode=t,e.init(),e.start(),e.img_bg.on(Laya.Event.MOUSE_DOWN,e,e.onMouseDown),e.img_bg.on(Laya.Event.MOUSE_UP,e,e.onMouseUp),e.label_control.on("click",e,e.gameControl),e}return __extends(r,i),r.prototype.onMouseDown=function(){this.mousePos.x=this.mouseX,this.mousePos.y=this.mouseY,this.mousePos.time=(new Date).valueOf()},r.prototype.onMouseUp=function(){if(1==this.gameStatus)if(this.frog.inJump)console.log("未落地，操作无效");else{if(!((new Date).valueOf()-this.mousePos.time>1200)){var t=this.mouseX-this.mousePos.x,i=this.mouseY-this.mousePos.y,e=Math.atan2(i,t);if(e<Math.PI/6&&e>0||e>=-Math.PI/6&&e<0){if(t<100)return;this.stepBig=!1,this.frog.jumpSmall()}if(e<-Math.PI/3&&e>2*-Math.PI/3){if(i>-100)return;this.stepBig=!0,this.frog.jumbBig()}}}else console.log("未进行，操作无效")},r.prototype.gameControl=function(){console.log("control...........",this.gameStatus),1==this.gameStatus?(this.label_control.changeText("继续"),this.pause()):(this.label_control.changeText("暂停"),this.continue())},r.prototype.start=function(){var t=this,i=this.COUNTDOWNNUM;this.changeTime(i+""),this.label_time.visible=!0,Laya.timer.loop(1e3,this,function(){if(--i<0)return t.gameStatus=1,t.label_time.visible=!1,Laya.timer.clearAll(t),Laya.timer.frameLoop(1,t,t.onLoop),void(t.label_control.visible=!0);t.changeTime(i+""),Laya.Tween.to(t.label_score,{scaleX:1,scaleY:1},500)})},r.prototype.changeTime=function(t){this.label_time.scale(2,2),this.label_time.changeText(t),Laya.Tween.to(this.label_time,{scaleX:1,scaleY:1},500)},r.prototype.pause=function(){this.gameStatus=0,Laya.timer.clearAll(this)},r.prototype.continue=function(){this.gameStatus=1,Laya.timer.frameLoop(1,this,this.onLoop)},r.prototype.gameOver=function(){var t=this,i=new s;i.on(i.PLAYAGIN,this,function(){t.playAgin()}),i.on(i.BACK,this,function(){t.quit()}),Laya.stage.addChild(i)},r.prototype.playAgin=function(){this.clearGame(),this.init(),this.start()},r.prototype.clearGame=function(){for(var i=this.pillarArray.length-1;i>-1;i--)this.pillarArray[i].removeSelf(),Laya.Pool.recover(t.Pillar.PILLARTAG,this.pillarArray[i]),this.pillarArray.pop()},r.prototype.quit=function(){Laya.timer.clearAll(this),this.frog.destroy(),Laya.Pool.clearBySign(t.Pillar.PILLARTAG),this.destroy(),utl.comeToLobby()},r.prototype.init=function(){this.frog&&this.frog.destroy(),this.frog=new a,this.frog.on(this.frog.ACTIONEND,this,this.frogActionOver),this.gameMap.addChild(this.frog),this.lastXpos=this.BEGINXPOS,this.score=0,this.label_score.changeText("分数："+this.score),this.gameSpeed=e.SPEED,this.frog.initPos(this.lastXpos,this.pillarYPos),this.frog.playAnimation(a.ACTIONS.stand),this.frog.speedX=0,this.lastHaveTrap=!1,this.pillarShowArray=t.Pillar.getPillarShowArray(!0).array,console.log("pillar...array.....",JSON.stringify(this.pillarShowArray)),this.pillarIndex=0,this.addPillar(this.lastXpos);do{this.addPillar()}while(this.lastXpos<=Laya.stage.width)},r.prototype.addPillar=function(i){if(i||(this.lastXpos=this.haveNullBefore?this.pillarArray[this.pillarArray.length-1].x+2*e.SMALLSTEP:this.pillarArray[this.pillarArray.length-1].x+e.SMALLSTEP),this.pillarIndex==this.pillarShowArray.length){var s=t.Pillar.getPillarShowArray(!1,this.pillarArrayIndex);this.pillarShowArray=s.array,this.pillarArrayIndex=s.idx,this.pillarIndex=0}if(2==this.pillarShowArray[this.pillarIndex])this.haveNullBefore=!0;else{this.haveNullBefore=!1;var a=3==this.pillarShowArray[this.pillarIndex],r=Laya.Pool.getItemByClass(t.Pillar.PILLARTAG,t.Pillar);r.init(this.lastXpos,this.pillarYPos,a),this.gameMap.addChild(r),this.pillarArray.push(r)}this.pillarIndex++},r.prototype.onLoop=function(){this.frog.inJump&&(this.frog.setSpeed(),this.frog.y-=this.frog.speedY);var i=this.gameSpeed-this.frog.speedX;if(this.frog.x-=i,this.frog.x-this.frog.width/2<0||this.frog.x+this.frog.width/2>=Laya.stage.width)this.frogBlast();else if(this.pillarArray.length){for(var s=this.pillarArray.length-1;s>-1;s--){var r=this.pillarArray[s];r.x-=this.gameSpeed,this.pillarArray[s].x<-e.PILLARWIDTH/2&&(Laya.Pool.recover(t.Pillar.PILLARTAG,r),this.pillarArray.shift()),this.frog.inJump&&this.frog.y>=this.pillarYPos&&this.frog.x>r.x-r.width/2-this.frog.width/2&&this.frog.x<r.x+r.width/2&&(Math.abs(this.frog.x-r.x)<r.width/2?r.haveTrap?this.frogBlast():(this.frog.x=r.x,this.score+=this.stepBig?2:1,this.label_score.changeText("分数："+this.score),this.frog.playAnimation(a.ACTIONS.landing),this.score>10&&this.speedAddTag<1&&(this.gameSpeed+=1,this.speedAddTag++,console.log("加速......10....")),this.score>30&&this.speedAddTag<2&&(this.gameSpeed+=1,this.speedAddTag++),this.score>50&&this.speedAddTag<3&&(this.gameSpeed+=2,this.speedAddTag++),this.score>80&&this.speedAddTag<4&&(this.gameSpeed+=2,this.speedAddTag++),this.score>100&&this.speedAddTag<5&&(this.gameSpeed+=1,this.speedAddTag++),this.score>120&&this.speedAddTag<6&&(this.gameSpeed+=1,this.speedAddTag++),this.score>150&&this.speedAddTag<7&&(this.gameSpeed+=1,this.speedAddTag++),this.score>200&&this.speedAddTag<8&&(this.gameSpeed+=2,this.speedAddTag++)):this.frog.y+this.frog.width/2>=this.pillarArray[s].x-this.pillarArray[s].width/2&&this.frogBlast())}this.pillarArray[this.pillarArray.length-1].x<=Laya.stage.width&&this.addPillar()}},r.prototype.frogBlast=function(){console.log("死了......."),this.pause(),this.frog.playAnimation(a.ACTIONS.blast)},r.prototype.frogActionOver=function(t){t==a.ACTIONS.stand||t==a.ACTIONS.flyUp||t==a.ACTIONS.jump||t==a.ACTIONS.upToDown||t==a.ACTIONS.flyDown||t==a.ACTIONS.landing||t==a.ACTIONS.blast&&this.gameOver()},r}(ui.game.GameMainUI);i.GameMainView=r}(t.view||(t.view={}))}(game||(game={}));