var game,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}();!function(t){var i=def.GameConfig,e=ad.AdView,s=function(s){function a(t){var i=s.call(this)||this;return i.BEGINXPOS=150,i.COUNTDOWNNUM=3,i.gameStatus=0,i.pillarArray=[],i.lastStepBig=!0,i.lastHaveTrap=!1,i.score=0,i.stepBig=!1,i.speedAddTag=0,i.mousePos={time:0,x:0,y:0},i.pillarYPos=3*Laya.stage.height/5,i.size(Laya.stage.width,Laya.stage.height),i.gameMode=t,i.init(),i.start(),i.img_bg.on(Laya.Event.MOUSE_DOWN,i,i.onMouseDown),i.img_bg.on(Laya.Event.MOUSE_UP,i,i.onMouseUp),i.label_control.on("click",i,i.gameControl),i}return __extends(a,s),a.prototype.onMouseDown=function(){this.mousePos.x=this.mouseX,this.mousePos.y=this.mouseY,this.mousePos.time=(new Date).valueOf()},a.prototype.onMouseUp=function(){if(1==this.gameStatus)if(this.frog.inJump)console.log("未落地，操作无效");else{if(!((new Date).valueOf()-this.mousePos.time>1200)){var t=this.mouseX-this.mousePos.x,i=this.mouseY-this.mousePos.y,e=Math.atan2(i,t);if(e<Math.PI/6&&e>0||e>=-Math.PI/6&&e<0){if(t<100)return;this.stepBig=!1,this.frog.jumpSmall()}if(e<-Math.PI/3&&e>2*-Math.PI/3){if(i>-100)return;this.stepBig=!0,this.frog.jumbBig()}}}else console.log("未进行，操作无效")},a.prototype.gameControl=function(){console.log("control...........",this.gameStatus),1==this.gameStatus?(this.label_control.changeText("继续"),this.pause()):(this.label_control.changeText("暂停"),this.continue())},a.prototype.start=function(){var t=this,i=this.COUNTDOWNNUM;this.changeTime(i+""),this.label_time.visible=!0,Laya.timer.loop(1e3,this,function(){if(--i<0)return t.gameStatus=1,t.label_time.visible=!1,Laya.timer.clearAll(t),Laya.timer.frameLoop(1,t,t.onLoop),void(t.label_control.visible=!0);t.changeTime(i+""),Laya.Tween.to(t.label_score,{scaleX:1,scaleY:1},500)})},a.prototype.changeTime=function(t){this.label_time.scale(2,2),this.label_time.changeText(t),Laya.Tween.to(this.label_time,{scaleX:1,scaleY:1},500)},a.prototype.pause=function(){this.gameStatus=0,Laya.timer.clearAll(this)},a.prototype.continue=function(){this.gameStatus=1,Laya.timer.frameLoop(1,this,this.onLoop)},a.prototype.gameOver=function(){var t=this,i=new e;i.on(i.PLAYAGIN,this,function(){t.playAgin()}),i.on(i.BACK,this,function(){t.quit()}),Laya.stage.addChild(i)},a.prototype.playAgin=function(){this.clearGame(),this.init(),this.start()},a.prototype.clearGame=function(){for(var i=this.pillarArray.length-1;i>-1;i--)this.pillarArray[i].removeSelf(),Laya.Pool.recover(t.Pillar.PILLARTAG,this.pillarArray[i]),this.pillarArray.pop()},a.prototype.quit=function(){Laya.timer.clearAll(this),this.frog.destroy(),Laya.Pool.clearBySign(t.Pillar.PILLARTAG),this.destroy(),utl.comeToLobby()},a.prototype.init=function(){this.frog&&this.frog.destroy(),this.frog=new t.Frog,this.frog.on(this.frog.ACTIONEND,this,this.frogActionOver),this.gameMap.addChild(this.frog),this.lastXpos=this.BEGINXPOS,this.score=0,this.label_score.changeText("分数："+this.score),this.gameSpeed=i.SPEED,this.frog.initPos(this.lastXpos,this.pillarYPos),this.frog.playAnimation(t.Frog.ACTIONS.stand),this.frog.speedX=0,this.lastHaveTrap=!1,this.pillarShowArray=t.Pillar.getPillarShowArray(!0).array,console.log("pillar...array.....",JSON.stringify(this.pillarShowArray)),this.pillarIndex=0,this.addPillar(this.lastXpos);do{this.addPillar()}while(this.lastXpos<=Laya.stage.width)},a.prototype.addPillar=function(e){if(e||(this.lastXpos=this.haveNullBefore?this.pillarArray[this.pillarArray.length-1].x+2*i.SMALLSTEP:this.pillarArray[this.pillarArray.length-1].x+i.SMALLSTEP),this.pillarIndex==this.pillarShowArray.length){var s=t.Pillar.getPillarShowArray(!1,this.pillarArrayIndex);this.pillarShowArray=s.array,this.pillarArrayIndex=s.idx,this.pillarIndex=0}if(2==this.pillarShowArray[this.pillarIndex])this.haveNullBefore=!0;else{this.haveNullBefore=!1;var a=3==this.pillarShowArray[this.pillarIndex],r=Laya.Pool.getItemByClass(t.Pillar.PILLARTAG,t.Pillar);r.init(this.lastXpos,this.pillarYPos,a),this.gameMap.addChild(r),this.pillarArray.push(r)}this.pillarIndex++},a.prototype.onLoop=function(){this.frog.inJump&&(this.frog.setSpeed(),this.frog.y-=this.frog.speedY);var e=this.gameSpeed-this.frog.speedX;if(this.frog.x-=e,this.frog.x-this.frog.width/2<0||this.frog.x+this.frog.width/2>=Laya.stage.width)this.frogBlast();else if(this.pillarArray.length){for(var s=this.pillarArray.length-1;s>-1;s--){var a=this.pillarArray[s];a.x-=this.gameSpeed,this.pillarArray[s].x<-i.PILLARWIDTH/2&&(Laya.Pool.recover(t.Pillar.PILLARTAG,a),this.pillarArray.shift()),this.frog.inJump&&this.frog.y>=this.pillarYPos&&this.frog.x>a.x-a.width/2-this.frog.width/2&&this.frog.x<a.x+a.width/2&&(Math.abs(this.frog.x-a.x)<a.width/2?a.haveTrap?this.frogBlast():(this.frog.x=a.x,this.score+=this.stepBig?2:1,this.label_score.changeText("分数："+this.score),this.frog.playAnimation(t.Frog.ACTIONS.landing),this.score>10&&this.speedAddTag<1&&(this.gameSpeed+=1,this.speedAddTag++,console.log("加速......10....")),this.score>30&&this.speedAddTag<2&&(this.gameSpeed+=1,this.speedAddTag++),this.score>50&&this.speedAddTag<3&&(this.gameSpeed+=2,this.speedAddTag++),this.score>80&&this.speedAddTag<4&&(this.gameSpeed+=2,this.speedAddTag++),this.score>100&&this.speedAddTag<5&&(this.gameSpeed+=1,this.speedAddTag++),this.score>120&&this.speedAddTag<6&&(this.gameSpeed+=1,this.speedAddTag++),this.score>150&&this.speedAddTag<7&&(this.gameSpeed+=1,this.speedAddTag++),this.score>200&&this.speedAddTag<8&&(this.gameSpeed+=2,this.speedAddTag++)):this.frog.y+this.frog.width/2>=this.pillarArray[s].x-this.pillarArray[s].width/2&&this.frogBlast())}this.pillarArray[this.pillarArray.length-1].x<=Laya.stage.width&&this.addPillar()}},a.prototype.frogBlast=function(){console.log("死了......."),this.pause(),this.frog.playAnimation(t.Frog.ACTIONS.blast)},a.prototype.frogActionOver=function(i){i==t.Frog.ACTIONS.stand||i==t.Frog.ACTIONS.flyUp||i==t.Frog.ACTIONS.jump||i==t.Frog.ACTIONS.upToDown||i==t.Frog.ACTIONS.flyDown||i==t.Frog.ACTIONS.landing||i==t.Frog.ACTIONS.blast&&this.gameOver()},a}(ui.game.GameMainUI);t.GameMain=s}(game||(game={}));